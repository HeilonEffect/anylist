{% extends "base.html" %}
{% block title %}{{ header }}{% endblock %}
{% block body %}
<main ng-controller="ListCtrl" class="cards">
	<img src="/static/img/add.svg" class="add_season" ng-click="add_form()" ng-if="token">
	

	<!-- Форма создания продукта -->
	<div class="add_product_form_parent" ng-show="add_form_visible" ng-click="add_form()">
		<form class="add_product_form" ng-click="add_form()" ng-submit="add_product()">
			<div ng-show="main_check">
                <div class="under_choicer">
				<label>Title:</label><br>
				<input type="text" placeholder="Title" ng-model="product.title"><br>
				<label>Description:</label><br>
				<textarea ng-model="product.description"></textarea>
				<span ng-repeat="item in uploader.queue">
					<span ng-show="uploader.isHTML5" ng-thumb="{file: item._file, height: 150}"></span>
				</span>
				<img src="/static/img/cancel.png" style="width: 50px;height: 50px" ng-click="remove_image()" ng-if="uploader.queue.length == 1">
				<input type="file" nv-file-select uploader="uploader" ng-if="uploader.queue.length == 0">
				<select ng-model="product.old_limit">
					<option ng-repeat="limit in raiting" value="{[{limit.id}]}">{[{limit.name}]}</option>
				</select>
                </div>
				<h2 ng-click="main_checked()" class="choicer">Next</h2>
			</div>
			<div ng-hide="main_check">
				<div class="under_choicer1">
                    <ul ng-repeat-start="group in genre_groups">
                        <li ng-repeat="genre in group.genres">
                            <input type="checkbox" id="{[{genre}]}_1" ng-model="genre.checked" ng-change="select_genre(genre)">
                            <label for="{[{genre}]}_1">{[{genre.name}]}</label>
                        </li>
                    </ul>
                    <div ng-repeat-end></div>
				</div>
                <h2 ng-click="main_checked()" class="choicer">Prev</h2>
			</div>
			<input type="submit" value="Create">
		</form>
	</div>
	<img src="/static/img/expand.png" class="expand" ng-click="show_panel()">
	<!-- Список продуктов -->
    <p></p>
	<ul>
		<li ng-repeat="product in products">
			<a href="{[{product.url}]}" ng-mouseenter="mouse_over(this)" ng-mouseleave="mouse_leave(this)">
				<div class="product_status" ng-if="user_list[product.id]">
					<p>{[{user_list[product.id].status}]}</p>
				</div>
                <div ng-if="token">
				    <img src="/static/img/add_w.png" class="add_to_list" ng-show="product.edit_btn" ng-click="add_to_list(this, $event, user_list)" ng-if="!user_list[product.id]">
				
				    <img src="/static/img/edit_w.png" class="edit_in_list" ng-show="product.edit_btn" ng-click="show_edit_form(this, $event)">
                </div>
				<div class="tooltip" ng-show="product.edit_btn">
                    <div class="description">
					    <p>{[{product.description}]}</p>
                    </div>
                    <div class="detail">
                        Raiting: {[{product.limit}]}
                        Genres: <span ng-repeat="genre in product.genres_list">{[{genre.name}]} </span>
                    </div>
				</div>
				<figure>
					<img src="{[{product.avatar}]}">
					<figcaption>{[{product.title}]}</figcaption>
				</figure>
			</a>
		</li>
	</ul>
	
	<nav ng-show="panel_visibility">
		<p>Raiting</p>
		<div ng-repeat="old_limit in raiting">
			<input type="checkbox" id="{[{old_limit.name}]}" ng-model="old_limit.checked" ng-change="start_filter(this)">
			<label for="{[{old_limit.name}]}">{[{old_limit.name}]}</label>
		</div>
		<p>Genres</p>
		<p ng-repeat-start="group in genre_groups">
			<div ng-repeat="genre in group.genres">
				<input type="checkbox" id="{[{genre}]}" ng-model="genre.checked" ng-change="start_filter(this)">
				<label for="{[{genre}]}">{[{genre.name}]}</label>
			</div>
		</p>
		<div ng-repeat-end></div>
	</nav>
</main>
{% endblock %}