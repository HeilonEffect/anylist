{% extends "base.html" %}
{% block content %}
	{% load wysiwyg %}
	{% wysiwyg_setup %}
	<form enctype="multipart/form-data" method="post" id="add_form">
			<input name="title" type="text" placeholder="Enter title here" class="form-title" value="{{ object.title }}" id="edit_title">
			<textarea class="form-textarea" rows="15" name="description" id="description">{{ object.description|safe }}</textarea>
			<div id="upload_form">
				<input type="file" name="avatar">
			</div>
		<div class="form-other">
			<select name="genres" id="genres" style="width:10em;" multiple>
			{% for genre in genres %}
				<option value="{{ genre.id }}">{{ genre.name }}</option>
			{% endfor %}
			</select>
			<p></p>
			<select name="old_limit" style="width:10em">
			{% for item in raiting %}
				<option value="{{ item.id }}">{{ item }}</option>
			{% endfor %}
			</select>
		</div>
		<div>
			{% csrf_token %}
			<button type="submit">Next Step</button>
		</div>
	</form>
	{% wysiwyg_editor "description" %}
{% endblock %}
{% block script %}
<script type="text/javascript">
	{% autoescape off %}
		var data = {{ use_genres }};
	{% endautoescape %}
	var preload_data = [];
	for (var i in data) {
		preload_data.push({id: '' + i, text: data[i]});	
	};
	$("#datetimepick1").datetimepicker({
		timepicker: false,
		format: 'd/m/Y'
	});
	$("#genres").select2({
		width: 400,
		placeholder: "Выберите жанры",
	});
	$("#genres").select2('data', preload_data);
	$("select[name='old_limit']").select2({
		width: 100
	});

	/* --------------------------------------
	// отправка данных формы
	*///-------------------------------------
	$("#add_form").submit({genres: genres}, function (eventObject) {
		// указываем, куда отсылать запрос
		var link = window.location.pathname.split("/");
		var url = [link[1], link[2]].join("/");
		console.log(url + "/edit");
		$("#add_form").attr("action", "/" + url + "/edit");
		//console.log(eventObject);
		//return false;
	});
	// добавляем id жанра в коллекцию, если установлен соответсвующий флажок
	$(".genre_check").click(function (eventObject) {
		var box = eventObject.currentTarget;
		if (box.checked)
			genres.push(box.id.split("-")[0]);
		else
			genres = genres.filter(function(elem) {
				return elem != box.id.split("-")[0];
			});
	});
</script>
{% endblock %}