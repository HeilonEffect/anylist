<!DOCTYPE html>
<html>
<head>
	<meta charset="utf8">
	<title>Base title</title>
	<link rel="stylesheet" type="text/css" href="/static/medialist.css">
	<link rel="stylesheet" type="text/css" href="/static/jquery.datetimepicker.css">
	<link rel="stylesheet" type="text/css" href="/static/avatars.css">
	<link rel="stylesheet" type="text/css" href="/static/select2/select2.css">
	<script type="text/javascript" src="/static/jquery.min.js"></script>
	<script type="text/javascript" src="/static/jquery.datetimepicker.js"></script>
	<script type="text/javascript" src="/static/medialist.js"></script>
	<script type="text/javascript" src="/static/select2/select2.js"></script>
	<script type="text/javascript">
		function csrfSafeMethod(method) {
    		// these HTTP methods do not require CSRF protection
	    	return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		}
		$.ajaxSetup({
	    	crossDomain: false, // obviates need for sameOrigin test
    		beforeSend: function(xhr, settings) {
        		if (!csrfSafeMethod(settings.type)) {
            		xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
        		}
    		}
		});


	function construct_url(dict) {
		// конструируем новый url (позже сделать его универсальным)
		// на основе старого + изменения
		var new_url = '/{{ category }}/filter/';
		for (var key in dict) {
			if (dict[key].length) {
				new_url += key + '/';
				for (var i in dict[key]) {
					new_url +=  dict[key][i] + ','
				}
				new_url = new_url.slice(0, new_url.length - 1) + '/';
			}
		}
		if (new_url == '/{{ category }}/filter/')
			new_url = '/{{ category }}';
		return new_url;
	}
	</script>
</head>
<body>
	<header>
	{% block header %}
		<img src="/static/glyphicons_156_show_thumbnails.png" class="nav_display" onclick="show_menu()">
		<hr>
		{% if user.is_authenticated %}
			<button id="logout">Log Out</button>
		{% else %}
			<button id="auth">Log In</button>
		{% endif %}
		<form id="auth_form">
			<input name="username" type="text" placeholder="Input Username"><br>
			<input name="password" type="password" placeholder="Input Password"><br>
			<input name="email" type="email" placeholder="Input Email"><br>
			<input type="checkbox" id="acc_tos"><label for="acc_tos">Register Me</label><br>
			<input type="submit" value="Log In">
		</form>
		{% include "components/nav.html" %}
	{% endblock %}
	</header>
	<main>
	{% block content %}
	{% endblock %}
	</main>
	<nav>
	{% block navigation %}
	{% endblock %}
	</nav>
	{% block script %}
	{% endblock %}
	<script type="text/javascript">
		update_checkboxes(url_resolve());
		$("#auth").click(function () {
			if ($("#auth_form").css("display") == "none")
				$("#auth_form").show();
			else
				$("#auth_form").hide();
		});
		$("#auth_form").submit(function () {
			if ($("#acc_tos")[0].checked)
				$.post(
					"/register",
					$("#auth_form").serialize()
				);
			else
				$.post(
					"/login",
					$("#auth_form").serialize()
				);
			return false;
		});
		$("#logout").click(function () {
			$.post(
				"/logout"
			);
		});
	</script>
</body>
</html>