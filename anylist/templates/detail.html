{% extends "base.html" %}
{% block title %}{{ header }}{% endblock %}
{% block header %}{{ header }}{% endblock %}
{% block body %}
<main ng-controller="DetailCtrl">
	<a href="edit">Edit</a>
	<article>
		<img src="{{ object.avatar_path }}">
		Genres: <a href="/{[{category}]}/filter/genres/{[{genre}]}" ng-repeat="genre in product.genres">{[{genre}]}, </a>
		<p>Old raiting: <a href="/{[{category}]}/filter/old_limit/{[{product.old_limit}]}">{[{product.old_limit}]}</a></p>
		<br>
		<p>
		{[{product.description}]}
		</p>
		<!-- {{ object.description|safe }} -->
	</article>
	<nav>
		<div>
			<input type="number">
			<img src="/static/img/delete.png"><br>
			<select>
				<option>--> Add To List</option>
				<option ng-click="status_move(this)" ng-repeat="status in statuses" ng-selected="{[{status == active_status }]}">{[{status}]}</option>
			</select>
		</div>
	</nav>
	</main>
{% endblock %}
{% block script %}
	<script>
		defaultApp.controller('DetailCtrl', ['$scope', '$http', '$location',
			function ($scope, $http, $location) {
				$scope.active_status = "{{ is_listed.status.name }}";
				$scope.statuses = ['Planned', 'Watch', 'ReWatching', 'Watched', 'Deffered', 'Dropped'];

				var id = window.location.pathname.split('/')[2].split('-')[0];

				$http.get('/api/products/id:' + id).success(function (data) {
					$scope.product = data;
				});

				$scope.category = window.location.pathname.split('/')[1];

				$scope.status_move = function (elem) {
					$http({
						method: "POST",
						url: $location.absUrl() + "status",
						data: 'name=' + elem.status,
						headers: {
							'Content-Type': 'application/x-www-form-urlencoded'
						}
					}).success(function (data) {
						$scope.active_status = elem.status;
					});
				}
			}
		]);
	</script>
{% endblock %}